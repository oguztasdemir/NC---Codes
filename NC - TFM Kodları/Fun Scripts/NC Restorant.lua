settings = {
couple = {"Devilstrkpro", "Atistiz"},
timeleft = 45,
xml = '<C><P F="6" Ca="" L="4800" /><Z><S><S L="120" X="60" H="160" Y="320" T="6" P="0,0,0.3,0.2,0,0,0,0" /><S L="20" X="130" H="140" Y="330" T="9" P="0,0,,,,0,0,0" /><S L="200" X="300" H="120" Y="260" T="6" P="0,0,0.3,0.2,0,0,0,0" /><S L="320" H="30" X="320" Y="385" T="6" P="0,0,0.3,0.2,0,0,0,0" /><S P="0,0,0.3,0.2,-140,0,0,0" L="300" X="107" N="" Y="-90" T="6" H="120" /><S P="0,0,0.3,0.2,-220,0,0,0" L="300" H="120" N="" Y="-38" T="6" X="555" /><S P="0,0,0.3,0.2,-170,0,0,0" L="300" H="120" N="" Y="20" T="6" X="341" /><S L="100" H="50" X="599" Y="397" T="6" P="0,0,0.3,0.2,-30,0,0,0" /><S L="100" X="680" H="50" Y="375" T="6" P="0,0,0.3,0.2,0,0,0,0" /><S L="50" X="800" H="200" Y="431" T="6" P="0,0,0.3,0.2,-20,0,0,0" /><S L="50" H="200" X="747" Y="444" T="6" P="0,0,0.3,0.2,-10,0,0,0" /><S L="100" H="200" X="855" Y="419" T="6" P="0,0,0.3,0.2,-10,0,0,0" /><S L="100" X="943" H="200" Y="393" T="6" P="0,0,0.3,0.2,-20,0,0,0" /><S P="0,0,0.3,0.2,-5,0,0,0" L="400" X="2048" c="2" N="" Y="347" T="5" H="400" /><S L="100" X="1116" H="280" Y="326" T="6" P="0,0,0,0.2,50,0,0,0" /><S L="100" H="280" X="1027" Y="394" T="6" P="0,0,0.3,0.2,-30,0,0,0" /><S L="100" H="280" X="1177" Y="382" T="6" P="0,0,0,0.2,40,0,0,0" /><S P="0,0,0.3,0.2,10,0,0,0" L="200" o="201109" X="1778" c="2" N="" Y="331" T="12" H="120" /><S L="100" X="1095" H="280" Y="362" T="6" P="0,0,0.3,0.2,-20,0,0,0" /><S L="100" X="1239" H="280" Y="420" T="6" P="0,0,0,0.2,30,0,0,0" /><S P="0,0,0.3,0.2,70,0,0,0" L="160" o="201109" X="1885" c="2" N="" Y="323" T="12" H="60" /><S H="120" L="70" o="201109" X="1845" c="2" N="" Y="266" T="12" P="0,0,0.3,0.2,10,0,0,0" /><S L="100" H="280" X="1166" Y="343" T="6" P="0,0,0.3,0.2,-10,0,0,0" /><S L="100" H="280" X="1323" Y="457" T="6" P="0,0,0,0.2,20,0,0,0" /><S H="120" L="120" o="201109" X="1710" c="2" Y="338" T="12" P="0,0,0.3,0.2,30,0,0,0" /><S L="100" X="1417" H="280" Y="480" T="6" P="0,0,0,0.2,10,0,0,0" /><S H="20" L="140" X="1650" c="4" Y="310" T="10" P="0,0,0.3,0,-60,0,0,0" /><S H="120" L="70" o="201109" X="1769" c="2" Y="276" T="12" P="0,0,0.3,0.2,70,0,0,0" /><S P="0,0,0.3,0.2,50,0,0,0" L="70" o="201109" X="1807" c="2" N="" Y="268" T="12" H="120" /><S P="0,0,0.3,0,70,0,0,0" L="300" H="20" c="2" N="" Y="344" T="10" X="1932" /><S H="400" L="400" X="2380" c="2" N="" Y="188" T="5" P="0,0,0.3,0.2,-30,0,0,0" /><S P="0,0,0,0.2,40,0,0,0" L="100" X="2486" N="" Y="483" T="6" H="280" /><S L="1100" H="280" X="1988" N="" Y="483" T="6" P="0,0,0,0.2,0,0,0,0" /><S L="60" H="20" X="1708" N="" Y="251" T="10" P="0,0,0.3,0,-5,0,0,0" /><S L="60" X="1765" H="20" N="" Y="241" T="10" P="0,0,0.3,0,-15,0,0,0" /><S L="60" H="20" X="1813" N="" Y="216" T="10" P="0,0,0.3,0,-40,0,0,0" /><S P="0,0,0.3,0,10,0,0,0" L="60" X="1858" N="" Y="204" T="10" H="20" /><S L="20" o="324650" H="120" X="2527" Y="283" T="12" P="0,0,0,0.2,0,0,0,0" /><S L="100" X="1190" H="20" Y="315" T="6" P="0,0,0.3,0.2,0,0,0,0" /><S L="60" o="5e5e5e" H="10" X="3975" Y="370" T="12" P="0,0,0.3,0.2,0,0,0,0" /><S L="100" H="200" X="4450" Y="415" T="10" P="0,0,0.3,0,-40,0,0,0" /><S L="880" X="4360" H="30" Y="385" T="10" P="0,0,0.3,0,0,0,0,0" /><S P="0,0,0.3,0.2,0,0,0,0" L="60" o="5e5e5e" H="10" Y="230" T="12" X="3975" /><S L="400" X="4140" H="20" Y="240" T="10" P="0,0,0.3,0,0,0,0,0" /><S P="0,0,0,0,0,0,0,0" L="20" o="324650" H="400" Y="214" T="12" m="" X="4810" /><S L="20" o="324650" H="400" X="3930" Y="50" T="12" m="" P="0,0,0,0,0,0,0,0" /><S L="500" X="4674" H="200" Y="406" T="10" P="0,0,0.3,0,0,0,0,0" /><S L="67" H="10" X="515" Y="401" T="2" P="0,0,0,1.2,0,0,0,0" /></S><D><DS Y="225" X="40" /><P P="0,0" Y="540" T="1" X="150" /><P X="190" Y="535" T="1" P="1,0" /><P P="1,0" Y="550" T="1" X="260" /><P P="1,0" Y="525" T="1" X="340" /><P X="385" Y="485" T="1" P="0,0" /><P P="0,0" Y="525" T="1" X="425" /><P P="0,0" Y="437" T="1" X="237" /><P X="275" Y="495" T="1" P="0,0" /><P P="0,0" Y="200" T="0" X="250" /><P P="1,0" Y="200" T="3" X="375" /><P P="1,1" Y="200" T="11" X="295" /><P P="1,0" Y="200" T="11" X="350" /><P X="215" Y="200" T="75" P="0,0" /><P X="1545" Y="343" T="1" P="0,0" /><P X="1528" Y="343" T="5" P="0,0" /><P X="1105" Y="215" T="4" P="0,0" /><P X="1461" Y="343" T="3" P="1,0" /><P X="1602" Y="342" T="11" P="1,0" /><P X="1165" Y="305" T="5" P="1,0" /><P X="1215" Y="305" T="2" P="1,0" /><P X="819" Y="325" T="6" P="0,0" /><P X="709" Y="351" T="0" P="0,0" /><P X="954" Y="275" T="3" P="1,1" /><P X="1055" Y="227" T="11" P="1,0" /><P C="e37ed7" Y="230" T="15" X="4239" P="0,0" /><P P="0,0" Y="306" T="67" X="4455" /><P P="0,1" Y="306" T="67" X="4546" /><P P="0,0" Y="306" T="68" X="4500" /><P P="0,0" Y="308" T="69" X="4605" /><P X="4015" Y="370" T="75" P="0,0" /><P X="4655" Y="225" T="77" P="0,0" /><P X="4678" Y="306" T="1" P="0,0" /><P P="0,0" Y="268" T="21" X="4500" /><P P="0,0" Y="307" T="52" X="4755" /><P P="0,0" C="bd4adb" Y="308" T="130" X="4707" /><P P="0,0" Y="371" T="124" X="4281" /><P P="0,0" Y="268" T="31" X="4521" /><P P="0,0" Y="265" T="55" X="4478" /></D><O /></Z></C>'
}

function main()
tfm.exec.disableAutoShaman(true)
tfm.exec.disableAutoNewGame(true)
tfm.exec.newGame(settings.xml)
tfm.exec.bindKeyboard("Kmlcan", 32, true, true)
end

function eventPlayerDied(n)
if n == settings.couple[1] or n == settings.couple[2] then
settings.timeleft = -10
announcement("<p align='center'><font size='18'>"..n.." Yemek salonuna gelirken öldüðünden dolayý düðün iptal edilmiþtir.")
end
end

function eventLoop()
settings.timeleft = settings.timeleft - 0.5
if settings.timeleft >= 0 then
updateTimeLeft()
end
for n, p in pairs(tfm.get.room.playerList) do
if p.x >= 1900 and p.x <= 2400 then
if n == settings.couple[1] or n == settings.couple[2] then
tfm.exec.movePlayer(n, 4045, 355)
else
tfm.exec.movePlayer(n, 4045, 215)
end
elseif (math.abs(p.x - 3975) <= 30) then
tfm.exec.movePlayer(n, 1585, 330)
end
if settings.timeleft < 0 and settings.timeleft > -1 then
if n == settings.couple[1] or n == settings.couple[2] then
if p.x < 3950 then
announcement("<p align='center'><font size='18'>"..n.." Yemeðe gelmediðinden dolayý düðün iptal edilmiþtir.")
break
else
announcement("<p align='center'><font size='24'>Yemek baþlamýþtýr! :) Ýyi Eðlenceler!")
questions()
end
end
end
end
end

function eventNewPlayer(n)
tfm.exec.respawnPlayer(n)
end

function eventNewGame()
tfm.exec.setUIMapName("Sevgili Restorant) <G>| <N>Zýkkýmlananlar : <V>"..settings.couple[1].." <BL>- <V>"..settings.couple[2])
tfm.exec.setNameColor(settings.couple[1], 0x006AFF)
tfm.exec.setNameColor(settings.couple[2], 0xFF00F0)
end

function updateTimeLeft()
local t1, t2, t, text = tostring(math.floor(math.ceil(settings.timeleft)/60)), tostring(math.floor(math.ceil(settings.timeleft)%60))
if #t1 < 2 then t1 = "0"..t1 end
if #t2 < 2 then t2 = "0"..t2 end
t = t1..":"..t2
text = "<p align='center'><font size='22'>Yemeðin baþlamasýna <V>"..t.." <N>saniye kaldý."
announcement(text)
end

function eventTextAreaCallback(id, n, cb)
if cb:sub(1, 6) == "answer" then
ui.addTextArea(6, "<J>"..n..": <N>"..cb:sub(7), nil, 4420, 310, 160, nil, 0, 1, 0.8)
ui.removeTextArea(3)
ui.removeTextArea(4)
ui.removeTextArea(5)
question = question + 1
if question < 9 then
questions(question)
end
end
end

function announcement(text, n)
ui.addTextArea(0, text, n, 4050, 265, 280, nil, 0, 1, 0.8)
ui.addTextArea(1, text, n, 420, 205, 280, nil, 0, 1, 0.8)
end

function questions(number)
number = question or 1
question = number
local n = settings.couple
local quests = {
{"Merhaba, sayýn "..n[1]..". Hoþgeldiniz", "Hanýmefendi Ne isterler :)", "Hoþbulduk"},
{"Siz de hoþ geldiniz, sayýn "..n[2]..".", "Yemeði söyleyebilirmiyiz ?", "Hoþ bulduk."},
{"Bugün "..n[1].." ve "..n[2].."'nin Yemeði için burdayýz", "Ben Tavuk ve Ice Tea almak istiyorum", "Ben hanýmefendi ne isterse onu istiyorum."},
{"Bugün "..n[1].." ve "..n[2].."'yi evlendirmek için buradayýz.", "Ben Tavuk ve Ice Tea almak istiyorum", "Teþekkür ederiz."},
{"Sayýn "..n[1]..", "..n[2].." Yemeðinizi Beðendinizmi ?", "Evet!", "Meleðim Beðendiyse benim için sorun yok."},
{"Peki siz, sayýn "..n[2]..", "..n[1].." Yemeðinizi Beðendinizmi ?", "Evet!", "Mükemmel Olmuþ."},
{"Melek Restoranttan yediðiniz için teþekkür ederiz.", "Hoþçakalýn", "Güle Güle"},
{"Melek Restoranttan yediðiniz için teþekkür ederiz.", "Hoþçakalýn", "Bay bay"},
}
ui.addTextArea(3, "<p align='center'>"..quests[number][1], nil, 4420, 120, 160, 60, 0, 1, 0.8)
ui.addTextArea(4, "<a href='event:answer"..quests[number][2].."'>"..quests[number][2], number%2 == 0 and n[2] or n[1], 4420, 185, nil, nil, 0, 1, 0.8)
ui.addTextArea(5, "<a href='event:answer"..quests[number][3].."'>"..quests[number][3], number%2 == 0 and n[2] or n[1], 4420, 210, nil, nil, 0, 1, 0.8)
end

main()